import {
  LayoutDashboard,
  Users,
  Shield,
  FileText,
  MapPin,
  Building2,
  School,
  ClipboardList,
  BarChart3,
  CheckSquare,
  BookOpen,
  Link,
  Bell,
  Database,
  Monitor,
  Settings,
  Clipboard,
  Baby,
  GraduationCap,
  UserCheck,
  Calculator,
  Briefcase,
  ClipboardCheck,
  Target,
  Award,
  Calendar,
  Clock,
  CheckCircle,
  LucideIcon,
} from 'lucide-react';
import { UserRole } from '@/contexts/AuthContext';

export interface MenuItem {
  id: string;
  label: string;
  path?: string;
  icon?: LucideIcon;
  children?: MenuItem[];
  roles?: UserRole[];
  description?: string;
}

export interface MenuGroup {
  id: string;
  label: string;
  items: MenuItem[];
  roles?: UserRole[];
}

// Improved navigation structure - cleaner and more logical
export const improvedNavigationConfig: MenuGroup[] = [
  // üè† Ana S…ôhif…ô
  {
    id: 'dashboard',
    label: 'Ana S…ôhif…ô',
    roles: ['superadmin', 'regionadmin', 'regionoperator', 'sektoradmin', 'schooladmin', 'm√º…ôllim'],
    items: [
      {
        id: 'dashboard-home',
        label: 'ƒ∞dar…ô Paneli',
        path: '/',
        icon: LayoutDashboard,
        roles: ['superadmin', 'regionadmin', 'regionoperator', 'sektoradmin', 'schooladmin', 'm√º…ôllim']
      }
    ]
  },

  // üè¢ Sistem ƒ∞dar…ôetm…ôsi v…ô Struktur
  {
    id: 'system-structure',
    label: 'Sistem ƒ∞dar…ôetm…ôsi',
    roles: ['superadmin', 'regionadmin', 'sektoradmin'],
    items: [
      {
        id: 'users',
        label: 'ƒ∞stifad…ô√ßil…ôr',
        path: '/users',
        icon: Users,
        roles: ['superadmin', 'regionadmin', 'sektoradmin']
      },
      {
        id: 'roles',
        label: 'Rollar v…ô ƒ∞caz…ôl…ôr',
        path: '/roles',
        icon: Shield,
        roles: ['superadmin']
      },
      {
        id: 'departments',
        label: 'Departmentl…ôr',
        path: '/departments',
        icon: Building2,
        roles: ['superadmin', 'regionadmin', 'sektoradmin']
      },
      {
        id: 'regions',
        label: 'Regionlar',
        path: '/regions',
        icon: MapPin,
        roles: ['superadmin']
      },
      {
        id: 'sectors',
        label: 'Sektorlar',
        path: '/sectors',
        icon: Target,
        roles: ['superadmin', 'regionadmin']
      },
      {
        id: 'institutions',
        label: '√úmumi T…ôhsil',
        path: '/institutions',
        icon: School,
        roles: ['superadmin', 'regionadmin', 'sektoradmin']
      },
      {
        id: 'preschools',
        label: 'M…ôkt…ôb…ôq…ôd…ôr',
        path: '/preschools',
        icon: Baby,
        roles: ['superadmin', 'regionadmin']
      },
      {
        id: 'hierarchy',
        label: 'ƒ∞erarxiya ƒ∞dar…ôsi',
        path: '/hierarchy',
        icon: Database,
        roles: ['superadmin', 'regionadmin']
      },
      {
        id: 'subjects',
        label: 'F…ônnl…ôr',
        path: '/subjects',
        icon: BookOpen,
        roles: ['superadmin', 'regionadmin']
      }
    ]
  },

  // üèõÔ∏è Sektor ƒ∞dar…ôetm…ôsi
  {
    id: 'sector-management',
    label: 'Sektor ƒ∞dar…ôetm…ôsi',
    roles: ['sektoradmin'],
    items: [
      {
        id: 'sector-overview',
        label: 'Sektor √úmumi G√∂r√ºn√º≈ü',
        path: '/',
        icon: LayoutDashboard,
        roles: ['sektoradmin'],
        description: 'Sektor statistikasƒ± v…ô √ºmumi m…ôlumatlar'
      },
      {
        id: 'sector-schools',
        label: 'Sektor M…ôkt…ôbl…ôri',
        icon: School,
        roles: ['sektoradmin'],
        children: [
          {
            id: 'sector-schools-list',
            label: 'M…ôkt…ôb Siyahƒ±sƒ±',
            path: '/institutions',
            roles: ['sektoradmin']
          },
          {
            id: 'sector-schools-students',
            label: 'Sektor ≈ûagirdl…ôri',
            path: '/students',
            roles: ['sektoradmin']
          },
          {
            id: 'sector-schools-classes',
            label: 'Sektor Sinifl…ôri',
            path: '/school/classes',
            roles: ['sektoradmin']
          }
        ]
      },
      {
        id: 'sector-staff',
        label: 'Sektor Kadrlarƒ±',
        icon: Users,
        roles: ['sektoradmin'],
        children: [
          {
            id: 'sector-users',
            label: 'Sektor ƒ∞stifad…ô√ßil…ôri',
            path: '/users',
            roles: ['sektoradmin']
          },
          {
            id: 'sector-teachers',
            label: 'Sektor M√º…ôlliml…ôri',
            path: '/school/teachers',
            roles: ['sektoradmin']
          }
        ]
      },
      {
        id: 'sector-schedules',
        label: 'Sektor C…ôdv…ôll…ôri',
        icon: Calendar,
        roles: ['sektoradmin'],
        children: [
          {
            id: 'sector-schedule-overview',
            label: 'C…ôdv…ôl √úmumi G√∂r√ºn√º≈ü',
            path: '/school/schedules',
            roles: ['sektoradmin']
          },
          {
            id: 'sector-teacher-schedules',
            label: 'M√º…ôllim C…ôdv…ôll…ôri',
            path: '/school/schedule-management',
            roles: ['sektoradmin']
          },
          {
            id: 'sector-workload',
            label: 'ƒ∞≈ü Y√ºk√º Analizi',
            path: '/school/workload',
            roles: ['sektoradmin']
          }
        ]
      },
      {
        id: 'sector-attendance',
        label: 'Sektor Davamiyy…ôti',
        icon: UserCheck,
        roles: ['sektoradmin'],
        children: [
          {
            id: 'sector-attendance-reports',
            label: 'Davamiyy…ôt Hesabatlarƒ±',
            path: '/school/attendance/reports',
            roles: ['sektoradmin']
          },
          {
            id: 'sector-attendance-daily',
            label: 'G√ºnl√ºk Davamiyy…ôt',
            path: '/school/attendance',
            roles: ['sektoradmin']
          }
        ]
      },
      {
        id: 'sector-assessments',
        label: 'Sektor Qiym…ôtl…ôndirm…ôsi',
        icon: Calculator,
        roles: ['sektoradmin'],
        children: [
          {
            id: 'sector-assessment-reports',
            label: 'Qiym…ôtl…ôndirm…ô Hesabatlarƒ±',
            path: '/assessments/results',
            roles: ['sektoradmin']
          }
        ]
      }
    ]
  },

  // üéì M…ôkt…ôb ƒ∞dar…ôetm…ôsi (Sad…ôl…ô≈üdirilmi≈ü)
  {
    id: 'school-management',
    label: 'M…ôkt…ôb ƒ∞dar…ôsi',
    roles: ['superadmin', 'schooladmin', 'm√º…ôllim'],
    items: [
      {
        id: 'students',
        label: '≈ûagirdl…ôr',
        icon: Users,
        roles: ['superadmin', 'schooladmin'],
        children: [
          {
            id: 'school-students',
            label: '≈ûagird Siyahƒ±sƒ±',
            path: '/students',
            roles: ['superadmin', 'schooladmin']
          },
          {
            id: 'student-enrollment',
            label: 'Yeni Qeydiyyat',
            path: '/students',
            roles: ['superadmin', 'schooladmin']
          }
        ]
      },
      {
        id: 'teachers',
        label: 'M√º…ôlliml…ôr',
        icon: GraduationCap,
        roles: ['superadmin', 'schooladmin'],
        children: [
          {
            id: 'school-teachers',
            label: 'M√º…ôllim Siyahƒ±sƒ±',
            path: '/school/teachers',
            roles: ['superadmin', 'schooladmin']
          },
          {
            id: 'teacher-performance',
            label: 'Performans Qiym…ôtl…ôndirm…ôsi',
            path: '/school/teachers/performance',
            roles: ['superadmin', 'schooladmin']
          }
        ]
      },
      {
        id: 'classes',
        label: 'Sinifl…ôr',
        icon: Building2,
        roles: ['superadmin', 'schooladmin'],
        children: [
          {
            id: 'school-classes',
            label: 'Sinif Siyahƒ±sƒ±',
            path: '/school/classes',
            roles: ['superadmin', 'schooladmin']
          },
          {
            id: 'class-schedules',
            label: 'D…ôrs C…ôdv…ôll…ôri',
            path: '/school/classes/schedules',
            roles: ['superadmin', 'schooladmin']
          }
        ]
      },
      {
        id: 'my-classes',
        label: 'M…ônim Sinifl…ôrim',
        path: '/school/my-classes',
        icon: BookOpen,
        roles: ['m√º…ôllim']
      }
    ]
  },

  // üìä Qiym…ôtl…ôndirm…ô v…ô Davamiyy…ôt
  {
    id: 'academic-tracking',
    label: 'Akademik ƒ∞zl…ôm…ô',
    roles: ['superadmin', 'regionadmin', 'sektoradmin', 'schooladmin', 'm√º…ôllim'],
    items: [
      {
        id: 'attendance',
        label: 'Davamiyy…ôt',
        icon: UserCheck,
        roles: ['superadmin', 'regionadmin', 'schooladmin', 'm√º…ôllim'],
        children: [
          {
            id: 'attendance-record',
            label: 'Davamiyy…ôt Qeydiyyatƒ±',
            path: '/school/attendance',
            roles: ['superadmin', 'regionadmin', 'schooladmin', 'm√º…ôllim']
          },
          {
            id: 'attendance-reports',
            label: 'Davamiyy…ôt Hesabatlarƒ±',
            path: '/school/attendance/reports',
            roles: ['superadmin', 'regionadmin', 'sektoradmin', 'schooladmin']
          }
        ]
      },
      {
        id: 'assessments',
        label: 'Qiym…ôtl…ôndirm…ô',
        icon: Calculator,
        roles: ['superadmin', 'regionadmin', 'sektoradmin', 'schooladmin', 'm√º…ôllim'],
        children: [
          {
            id: 'assessment-types',
            label: 'Qiym…ôtl…ôndirm…ô N√∂vl…ôri',
            path: '/assessments/types',
            roles: ['superadmin', 'regionadmin']
          },
          {
            id: 'assessment-entry',
            label: 'Qiym…ôt Daxil Etm…ô',
            path: '/assessments/entry',
            roles: ['superadmin', 'regionadmin', 'sektoradmin', 'schooladmin', 'm√º…ôllim']
          },
          {
            id: 'gradebook',
            label: 'Qiym…ôt D…ôft…ôri',
            path: '/school/gradebook',
            roles: ['superadmin', 'schooladmin', 'm√º…ôllim']
          },
          {
            id: 'assessment-results',
            label: 'N…ôtic…ôl…ôr v…ô Anali–∑',
            path: '/assessments/results',
            roles: ['superadmin', 'regionadmin', 'sektoradmin', 'schooladmin']
          }
        ]
      }
    ]
  },

  // üìÖ C…ôdv…ôl ƒ∞dar…ôetm…ôsi
  {
    id: 'schedule-management',
    label: 'C…ôdv…ôl ƒ∞dar…ôetm…ôsi',
    roles: ['superadmin', 'regionadmin', 'sektoradmin', 'schooladmin', 'm√º…ôllim'],
    items: [
      {
        id: 'schedule-overview',
        label: 'D…ôrs C…ôdv…ôll…ôri',
        icon: Calendar,
        roles: ['superadmin', 'regionadmin', 'sektoradmin', 'schooladmin', 'm√º…ôllim'],
        children: [
          {
            id: 'school-schedule-management',
            label: 'M…ôkt…ôb C…ôdv…ôl ƒ∞dar…ôetm…ôsi',
            path: '/school/schedule-management',
            roles: ['superadmin', 'schooladmin']
          },
          {
            id: 'school-schedules',
            label: 'M…ôkt…ôb C…ôdv…ôll…ôri',
            path: '/school/schedules',
            roles: ['superadmin', 'schooladmin']
          },
          {
            id: 'regional-schedules',
            label: 'Regional C…ôdv…ôl N…ôzar…ôti',
            path: '/regionadmin/schedules',
            roles: ['superadmin', 'regionadmin']
          },
          {
            id: 'teacher-schedule',
            label: 'M√º…ôllim C…ôdv…ôli',
            path: '/teacher/schedule',
            roles: ['superadmin', 'm√º…ôllim']
          },
          {
            id: 'school-workload',
            label: 'D…ôrs Y√ºk√º',
            path: '/school/workload',
            roles: ['superadmin', 'schooladmin']
          }
        ]
      }
    ]
  },

  // üìÅ M…ôzmun ƒ∞dar…ôetm…ôsi
  {
    id: 'content',
    label: 'M…ôzmun ƒ∞dar…ôetm…ôsi',
    roles: ['superadmin', 'regionadmin', 'regionoperator', 'sektoradmin', 'schooladmin'],
    items: [
      {
        id: 'tasks',
        label: 'Tap≈üƒ±rƒ±qlar',
        path: '/tasks',
        icon: ClipboardCheck,
        roles: ['superadmin', 'regionadmin', 'regionoperator', 'sektoradmin', 'schooladmin']
      },
      {
        id: 'school-tasks',
        label: 'M…ôkt…ôb Tap≈üƒ±rƒ±qlarƒ±',
        path: '/school/tasks',
        icon: CheckSquare,
        roles: ['superadmin', 'schooladmin']
      },
      {
        id: 'surveys',
        label: 'Sorƒüular',
        icon: ClipboardList,
        roles: ['superadmin', 'regionadmin', 'regionoperator', 'sektoradmin', 'schooladmin'],
        children: [
          {
            id: 'survey-list',
            label: 'Sorƒüu Siyahƒ±sƒ±',
            path: '/surveys',
            roles: ['superadmin', 'regionadmin', 'regionoperator', 'sektoradmin', 'schooladmin']
          },
          {
            id: 'approvals',
            label: 'T…ôsdiq Paneli',
            path: '/approvals',
            roles: ['superadmin', 'regionadmin', 'sektoradmin']
          },
          {
            id: 'survey-results',
            label: 'Sorƒüu N…ôtic…ôl…ôri',
            path: '/survey-results',
            roles: ['superadmin', 'regionadmin', 'sektoradmin']
          },
          {
            id: 'school-surveys',
            label: 'M…ôkt…ôb Sorƒüularƒ±',
            path: '/school/surveys',
            roles: ['superadmin', 'schooladmin']
          }
        ]
      },
      {
        id: 'documents',
        label: 'S…ôn…ôdl…ôr',
        path: '/documents',
        icon: FileText,
        roles: ['superadmin', 'regionadmin', 'regionoperator', 'sektoradmin', 'schooladmin']
      },
      {
        id: 'links',
        label: 'Faydalƒ± Linkl…ôr',
        path: '/links',
        icon: Link,
        roles: ['superadmin', 'regionadmin', 'regionoperator', 'sektoradmin', 'schooladmin']
      }
    ]
  },

  // üìà Hesabat v…ô Analitika
  {
    id: 'analytics',
    label: 'Hesabat v…ô Analitika',
    roles: ['superadmin', 'regionadmin', 'sektoradmin', 'schooladmin'],
    items: [
      {
        id: 'reports',
        label: 'Hesabatlar',
        path: '/reports',
        icon: FileText,
        roles: ['superadmin', 'regionadmin', 'sektoradmin', 'schooladmin']
      },
      {
        id: 'analytics',
        label: 'Sistem Analitikasƒ±',
        path: '/analytics',
        icon: BarChart3,
        roles: ['superadmin', 'regionadmin', 'sektoradmin']
      }
    ]
  },

  // üîî Bildiri≈ül…ôr
  {
    id: 'notifications',
    label: 'Bildiri≈ül…ôr',
    roles: ['superadmin', 'regionadmin'],
    items: [
      {
        id: 'notifications',
        label: 'Bildiri≈ül…ôr',
        path: '/notifications',
        icon: Bell,
        roles: ['superadmin', 'regionadmin']
      }
    ]
  },

  // ‚öôÔ∏è Sistem T…ônziml…ôm…ôl…ôri
  {
    id: 'system-settings',
    label: 'Sistem T…ônziml…ôm…ôl…ôri',
    roles: ['superadmin'],
    items: [
      {
        id: 'settings',
        label: 'Sistem Parametrl…ôri',
        path: '/settings',
        icon: Settings,
        roles: ['superadmin']
      },
      {
        id: 'audit-logs',
        label: 'Audit Loglarƒ±',
        path: '/audit-logs',
        icon: Clipboard,
        roles: ['superadmin']
      },
      {
        id: 'performance',
        label: 'Performans Monitorinqi',
        path: '/performance',
        icon: Monitor,
        roles: ['superadmin']
      }
    ]
  }
];

// Main navigation config export
export const universalNavigationConfig = improvedNavigationConfig;

export const getMenuForRole = (role: UserRole): MenuGroup[] => {
  return universalNavigationConfig
    .filter(group => !group.roles || group.roles.includes(role))
    .map(group => ({
      ...group,
      items: filterMenuItems(group.items, role)
    }))
    .filter(group => group.items.length > 0);
};

// Helper function to recursively filter menu items based on role
function filterMenuItems(items: MenuItem[], role: UserRole): MenuItem[] {
  return items
    .filter(item => !item.roles || item.roles.includes(role))
    .map(item => ({
      ...item,
      children: item.children ? filterMenuItems(item.children, role) : undefined
    }))
    .filter(item => !item.children || item.children.length > 0);
}

export const findMenuItem = (path: string): MenuItem | null => {
  for (const group of universalNavigationConfig) {
    for (const item of group.items) {
      if (item.path === path) return item;
      if (item.children) {
        const found = findChildMenuItem(item.children, path);
        if (found) return found;
      }
    }
  }
  return null;
};

function findChildMenuItem(items: MenuItem[], path: string): MenuItem | null {
  for (const item of items) {
    if (item.path === path) return item;
    if (item.children) {
      const found = findChildMenuItem(item.children, path);
      if (found) return found;
    }
  }
  return null;
}